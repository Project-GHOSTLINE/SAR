# üìä DataFlow Complet + Checklist des T√¢ches

**Date:** 2026-01-22
**Projet:** Solution Argent Rapide (SAR)
**Objectif:** Comprendre le flux complet et ce qui reste √† faire

---

## üéØ DATAFLOW ACTUEL (CE QUI EXISTE)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 1: CLIENT FAIT UNE DEMANDE                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ Client remplit formulaire
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 2: V√âRIFICATION BANCAIRE INVERITE                       ‚îÇ
‚îÇ  ‚Ä¢ Client va sur Inverite.com                                   ‚îÇ
‚îÇ  ‚Ä¢ Connecte son compte bancaire                                 ‚îÇ
‚îÇ  ‚Ä¢ Inverite r√©cup√®re 90 jours de transactions                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ Client termine v√©rification
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 3: ADMIN OUVRE INVERITE DANS CHROME                     ‚îÇ
‚îÇ  ‚Ä¢ Admin va sur app.inverite.com/view/{guid}                   ‚îÇ
‚îÇ  ‚Ä¢ Voit les donn√©es du client                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ Admin clique "T√©l√©charger JSON"
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 4: EXTENSION CHROME CAPTURE                             ‚îÇ
‚îÇ  üìÅ Extension: inverite-json-downloader-v9.2.2                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Actions:                                                        ‚îÇ
‚îÇ  1. D√©tecte GUID dans URL                                       ‚îÇ
‚îÇ  2. Appelle GET /api/v2/fetch/{guid}                           ‚îÇ
‚îÇ  3. Re√ßoit JSON avec comptes + transactions                     ‚îÇ
‚îÇ  4. T√©l√©charge: Fred-Rosa-2025-12-22.json                      ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Localisation: ~/Downloads/                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ ‚ö†Ô∏è √âTAPE MANQUANTE!
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚ùå √âTAPE 5: ??? UPLOAD VERS SAR ???                           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Actuellement: MANUEL ou MANQUANT                              ‚îÇ
‚îÇ  Options possibles:                                             ‚îÇ
‚îÇ  ‚Ä¢ Upload manuel dans un formulaire?                            ‚îÇ
‚îÇ  ‚Ä¢ Script qui surveille ~/Downloads/?                           ‚îÇ
‚îÇ  ‚Ä¢ Autre extension Chrome?                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ Si les donn√©es arrivent...
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 6: SAR API RE√áOIT ET STOCKE                             ‚îÇ
‚îÇ  üìÅ Fichier: src/app/api/admin/client-analysis/route.ts       ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  POST /api/admin/client-analysis                               ‚îÇ
‚îÇ  ‚Ä¢ Valide l'authentification                                    ‚îÇ
‚îÇ  ‚Ä¢ Extrait infos client (nom, email, t√©l√©phone)                ‚îÇ
‚îÇ  ‚Ä¢ Calcule totaux (accounts, balance, transactions)            ‚îÇ
‚îÇ  ‚Ä¢ INSERT dans Supabase table: client_analyses                 ‚îÇ
‚îÇ    - Colonne raw_data (JSONB) ‚Üê TOUTES les donn√©es            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ Donn√©es stock√©es
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 7: SUPABASE - BASE DE DONN√âES                           ‚îÇ
‚îÇ  Table: client_analyses                                         ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Colonnes:                                                       ‚îÇ
‚îÇ  ‚Ä¢ id (UUID)                                                    ‚îÇ
‚îÇ  ‚Ä¢ client_name                                                  ‚îÇ
‚îÇ  ‚Ä¢ client_email                                                 ‚îÇ
‚îÇ  ‚Ä¢ raw_data (JSONB) ‚Üê Comptes + Transactions                   ‚îÇ
‚îÇ  ‚Ä¢ source ('inverite' ou 'flinks')                             ‚îÇ
‚îÇ  ‚Ä¢ total_accounts                                               ‚îÇ
‚îÇ  ‚Ä¢ total_balance                                                ‚îÇ
‚îÇ  ‚Ä¢ status (pending/reviewed/approved/rejected)                 ‚îÇ
‚îÇ  ‚Ä¢ created_at                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ Admin ouvre analyse
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 8: ADMIN VISUALISE                                      ‚îÇ
‚îÇ  üìÅ Page: admin.solutionargentrapide.ca/admin/analyse?id=xxx   ‚îÇ
‚îÇ  üìÅ Fichier: src/app/admin/analyse/page.tsx                    ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Actions:                                                        ‚îÇ
‚îÇ  1. GET /api/admin/client-analysis?id={uuid}                   ‚îÇ
‚îÇ  2. API lit depuis Supabase                                     ‚îÇ
‚îÇ  3. Retourne raw_data + m√©tadonn√©es                            ‚îÇ
‚îÇ  4. Page affiche:                                               ‚îÇ
‚îÇ     ‚Ä¢ Infos client (nom, email, t√©l√©phone, adresse)            ‚îÇ
‚îÇ     ‚Ä¢ Liste des comptes bancaires                               ‚îÇ
‚îÇ     ‚Ä¢ Transactions d√©taill√©es avec filtres                      ‚îÇ
‚îÇ     ‚Ä¢ Statistiques (soldes, totaux)                             ‚îÇ
‚îÇ     ‚Ä¢ Red flags (NSF, retours)                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ Admin prend d√©cision
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 9: D√âCISION MANUELLE                                    ‚îÇ
‚îÇ  ‚Ä¢ Admin examine les donn√©es                                    ‚îÇ
‚îÇ  ‚Ä¢ Calcule ratios manuellement                                  ‚îÇ
‚îÇ  ‚Ä¢ Prend d√©cision: Approuver / Refuser                         ‚îÇ
‚îÇ  ‚Ä¢ Change status dans l'interface                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ DATAFLOW ID√âAL (CE QUI DEVRAIT EXISTER)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 1: CLIENT ‚Üí INVERITE                                    ‚îÇ
‚îÇ  (M√™me chose qu'actuellement)                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 2: EXTENSION CHROME V2 (AM√âLIOR√âE) üÜï                   ‚îÇ
‚îÇ  üìÅ Extension: sar-inverite-auto-upload-v2                     ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Actions automatiques:                                          ‚îÇ
‚îÇ  1. D√©tecte GUID dans URL                                       ‚îÇ
‚îÇ  2. Appelle GET /api/v2/fetch/{guid}                           ‚îÇ
‚îÇ  3. Appelle POST /api/v2/risk ‚Üí Risk Score üî•                  ‚îÇ
‚îÇ  4. Appelle POST /api/v2/microcheck/search ‚Üí Pr√™ts rapides üö® ‚îÇ
‚îÇ  5. Combine tout dans un JSON enrichi                           ‚îÇ
‚îÇ  6. POST automatique vers SAR API ‚úÖ                            ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  R√©sultat: Donn√©es arrivent dans SAR en 30 secondes!          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 3: SAR API RE√áOIT DONN√âES ENRICHIES                     ‚îÇ
‚îÇ  POST /api/admin/client-analysis                               ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Donn√©es re√ßues:                                                ‚îÇ
‚îÇ  ‚Ä¢ Comptes + Transactions (comme avant)                         ‚îÇ
‚îÇ  ‚Ä¢ Risk Score: 750/850 üî•                                       ‚îÇ
‚îÇ  ‚Ä¢ Microloans: D√©tect√© (3 pr√™teurs) üö®                         ‚îÇ
‚îÇ  ‚Ä¢ Recommandation: APPROVE ou DECLINE                           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Action: Stocke TOUT dans Supabase                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 4: MOTEUR D'ANALYSE AUTOMATIQUE üÜï                      ‚îÇ
‚îÇ  üìÅ Nouveau: src/lib/loan-analyzer.ts                          ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Calculs automatiques:                                          ‚îÇ
‚îÇ  ‚Ä¢ Ratio d'endettement (DTI)                                    ‚îÇ
‚îÇ  ‚Ä¢ Revenu net moyen                                             ‚îÇ
‚îÇ  ‚Ä¢ D√©penses fixes (loyer, factures)                            ‚îÇ
‚îÇ  ‚Ä¢ Historique NSF/retours                                       ‚îÇ
‚îÇ  ‚Ä¢ Score composite SAR (300-850)                                ‚îÇ
‚îÇ  ‚Ä¢ Montant max recommand√©                                       ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  R√©sultat: Recommandation automatique                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 5: ADMIN VOIT RECOMMANDATION                            ‚îÇ
‚îÇ  üìÅ Page am√©lior√©e: /admin/analyse?id=xxx                      ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Affichage:                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇ  üéØ RECOMMANDATION: APPROUVER          ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  Score SAR: 720/850                     ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  Montant max: $3,500                    ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  Confiance: 85%                         ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ                                          ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  [APPROUVER $3,500] [AJUSTER] [REFUSER] ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚Ä¢ Admin peut accepter en 1 clic                                ‚îÇ
‚îÇ  ‚Ä¢ Ou ajuster le montant manuellement                           ‚îÇ
‚îÇ  ‚Ä¢ Voir tous les d√©tails si n√©cessaire                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  √âTAPE 6: D√âCISION RAPIDE                                      ‚îÇ
‚îÇ  ‚Ä¢ Temps moyen: 2 minutes (vs 20 minutes avant)                ‚îÇ
‚îÇ  ‚Ä¢ R√©duction erreurs humaines                                   ‚îÇ
‚îÇ  ‚Ä¢ Tra√ßabilit√© compl√®te                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ CHECKLIST COMPL√àTE DES T√ÇCHES

### üî¥ PHASE 1: COMBLER LE TROU (Priorit√© URGENTE)

**Objectif:** Faire arriver les donn√©es dans SAR automatiquement

#### ‚òê T√¢che 1.1: Cr√©er Extension Chrome V2
**Dur√©e:** 4-6 heures
**Fichiers:**
- [ ] Cr√©er `/extension-sar-v2/manifest.json`
- [ ] Cr√©er `/extension-sar-v2/config.js` (avec API keys)
- [ ] Cr√©er `/extension-sar-v2/content-script.js`

**Code √† √©crire:**
```javascript
// content-script.js
async function captureAndUpload(guid) {
  // 1. Fetch donn√©es Inverite
  const inveriteData = await fetch(
    `https://www.inverite.com/api/v2/fetch/${guid}`,
    { headers: { 'Auth': CONFIG.INVERITE_API_KEY } }
  ).then(r => r.json());

  // 2. POST vers SAR
  const response = await fetch(
    'https://solutionargentrapide.ca/api/admin/client-analysis',
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${CONFIG.SAR_TOKEN}`
      },
      body: JSON.stringify({
        client_name: inveriteData.name,
        raw_data: inveriteData,
        source: 'inverite',
        inverite_guid: guid
      })
    }
  );

  return response.json();
}
```

**Acceptance Criteria:**
- [ ] Bouton "Envoyer vers SAR" appara√Æt sur Inverite
- [ ] Clic sur bouton envoie automatiquement les donn√©es
- [ ] Confirmation de succ√®s affich√©e
- [ ] Donn√©es arrivent dans Supabase `client_analyses`

---

#### ‚òê T√¢che 1.2: G√©n√©rer Token Bearer pour Extension
**Dur√©e:** 30 minutes
**Fichiers:**
- [ ] Cr√©er `/scripts/generate-extension-token.mjs`

**Code:**
```javascript
import { SignJWT } from 'jose'

const secret = new TextEncoder().encode(process.env.JWT_SECRET)

const token = await new SignJWT({ extension: 'sar-inverite-v2' })
  .setProtectedHeader({ alg: 'HS256' })
  .setExpirationTime('1y')
  .sign(secret)

console.log('Token pour extension:', token)
// Copier dans extension-sar-v2/config.js
```

**Acceptance Criteria:**
- [ ] Token g√©n√©r√© avec expiration 1 an
- [ ] Token test√© avec `/api/admin/client-analysis`
- [ ] Token ajout√© dans `config.js` de l'extension

---

#### ‚òê T√¢che 1.3: Tester le Flow Complet
**Dur√©e:** 1 heure
**Tests:**
- [ ] Extension d√©tecte GUID sur Inverite
- [ ] Clic bouton capture les donn√©es
- [ ] POST arrive sur SAR API
- [ ] Donn√©es stock√©es dans Supabase
- [ ] Admin peut voir l'analyse dans `/admin/analyse`

---

### üü° PHASE 2: ENRICHIR LES DONN√âES (Priorit√© HAUTE)

**Objectif:** Ajouter Risk Score et Microcheck

#### ‚òê T√¢che 2.1: Impl√©menter Risk Score API
**Dur√©e:** 3-4 heures
**Fichiers:**
- [ ] Modifier `/extension-sar-v2/content-script.js`
- [ ] Ajouter fonction `getRiskScore(guid)`

**Code:**
```javascript
async function getRiskScore(guid) {
  // 1. Cr√©er demande risk
  const riskReq = await fetch(
    'https://www.inverite.com/api/v2/risk',
    {
      method: 'POST',
      headers: {
        'Auth': CONFIG.INVERITE_API_KEY,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ request: guid })
    }
  );

  const { task_id } = await riskReq.json();

  // 2. Poller status (max 1 minute)
  for (let i = 0; i < 12; i++) {
    await sleep(5000);

    const statusReq = await fetch(
      `https://www.inverite.com/api/v2/risk_status/${task_id}`,
      { headers: { 'Auth': CONFIG.INVERITE_API_KEY } }
    );

    const riskData = await statusReq.json();

    if (riskData.status === 'success') {
      return riskData;
    }
  }

  return { error: 'Timeout' };
}
```

**Acceptance Criteria:**
- [ ] Risk Score r√©cup√©r√© avec succ√®s
- [ ] Score inclus dans le JSON envoy√© √† SAR
- [ ] SAR stocke le risk_score dans Supabase
- [ ] Admin voit le risk_score dans l'interface

---

#### ‚òê T√¢che 2.2: Ajouter Microcheck Detection
**Dur√©e:** 2 heures
**Fichiers:**
- [ ] Modifier `/extension-sar-v2/content-script.js`
- [ ] Ajouter fonction `checkMicroloans(guid)`

**Code:**
```javascript
async function checkMicroloans(guid) {
  const response = await fetch(
    'https://www.inverite.com/api/v2/microcheck/search',
    {
      method: 'POST',
      headers: {
        'Auth': CONFIG.INVERITE_API_KEY,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        guid: guid,
        days: 90
      })
    }
  );

  return response.json();
}
```

**Acceptance Criteria:**
- [ ] Microloans d√©tect√©s avec succ√®s
- [ ] Donn√©es incluses dans le JSON vers SAR
- [ ] Admin voit les pr√™teurs d√©tect√©s
- [ ] RED FLAG affich√© si microloans > 0

---

#### ‚òê T√¢che 2.3: Modifier Sch√©ma Supabase
**Dur√©e:** 30 minutes
**Fichiers:**
- [ ] Cr√©er `/database/migrations/add_risk_and_microcheck.sql`

**SQL:**
```sql
-- Ajouter colonnes pour risk score et microcheck
ALTER TABLE client_analyses
ADD COLUMN risk_score INTEGER,
ADD COLUMN risk_level TEXT,
ADD COLUMN has_microloans BOOLEAN DEFAULT FALSE,
ADD COLUMN microloans_data JSONB;

-- Cr√©er index pour recherche rapide
CREATE INDEX idx_risk_score ON client_analyses(risk_score);
CREATE INDEX idx_has_microloans ON client_analyses(has_microloans);
```

**Acceptance Criteria:**
- [ ] Migration ex√©cut√©e sur Supabase
- [ ] Nouvelles colonnes disponibles
- [ ] API SAR modifi√©e pour stocker ces donn√©es

---

#### ‚òê T√¢che 2.4: Modifier API SAR pour Recevoir Risk Score
**Dur√©e:** 1 heure
**Fichiers:**
- [ ] Modifier `/src/app/api/admin/client-analysis/route.ts`

**Code:**
```typescript
// Ligne ~183 - Ajouter dans analysisData
const analysisData: any = {
  client_name: body.client_name,
  // ... autres champs
  risk_score: body.risk_score || null,
  risk_level: body.risk_level || null,
  has_microloans: body.has_microloans || false,
  microloans_data: body.microloans_data || null
}
```

**Acceptance Criteria:**
- [ ] API accepte les nouveaux champs
- [ ] Donn√©es stock√©es correctement
- [ ] Tests passent

---

#### ‚òê T√¢che 2.5: Afficher Risk Score dans Admin
**Dur√©e:** 2 heures
**Fichiers:**
- [ ] Modifier `/src/app/admin/analyse/page.tsx`

**UI √† ajouter:**
```tsx
{/* Risk Score Card */}
{analysis.risk_score && (
  <div className="card bg-gradient-to-r from-blue-500 to-purple-500 text-white">
    <h3 className="text-2xl font-bold">Risk Score Inverite</h3>
    <div className="text-6xl font-bold my-4">
      {analysis.risk_score}
      <span className="text-2xl">/850</span>
    </div>
    <div className="flex items-center gap-2">
      <Badge>{analysis.risk_level?.toUpperCase()}</Badge>
      {analysis.risk_score >= 700 && <Check className="text-green-400" />}
      {analysis.risk_score < 700 && <AlertTriangle className="text-yellow-400" />}
    </div>
  </div>
)}

{/* Microloans Warning */}
{analysis.has_microloans && (
  <div className="alert alert-danger">
    <AlertCircle className="text-red-500" />
    <div>
      <h4 className="font-bold">‚ö†Ô∏è Pr√™ts Rapides D√©tect√©s</h4>
      <p>Ce client a {analysis.microloans_data?.lenders?.length} pr√™teurs actifs</p>
    </div>
  </div>
)}
```

**Acceptance Criteria:**
- [ ] Risk Score affich√© de fa√ßon visuelle
- [ ] Couleurs selon le niveau (vert/jaune/rouge)
- [ ] Warning affich√© si microloans
- [ ] Liste des pr√™teurs affich√©e

---

### üü¢ PHASE 3: MOTEUR D'ANALYSE AUTOMATIQUE (Priorit√© MOYENNE)

**Objectif:** Calculer automatiquement recommandation de pr√™t

#### ‚òê T√¢che 3.1: Cr√©er Moteur d'Analyse
**Dur√©e:** 8 heures
**Fichiers:**
- [ ] Cr√©er `/src/lib/loan-analyzer.ts`

**Code:**
```typescript
export interface LoanAnalysis {
  recommendation: 'approve' | 'decline' | 'review';
  max_loan_amount: number;
  confidence: number;
  sar_score: number;
  factors: {
    income_stability: number;
    dti_ratio: number;
    nsf_history: number;
    account_age: number;
  };
  red_flags: string[];
}

export function analyzeLoanApplication(
  rawData: any,
  riskScore?: number
): LoanAnalysis {
  // 1. Calculer revenus mensuels
  const monthlyIncome = calculateMonthlyIncome(rawData);

  // 2. Calculer d√©penses fixes
  const monthlyExpenses = calculateMonthlyExpenses(rawData);

  // 3. Calculer DTI (Debt-to-Income ratio)
  const dti = monthlyExpenses / monthlyIncome;

  // 4. Analyser historique NSF
  const nsfCount = countNSF(rawData);

  // 5. Calculer score SAR (300-850)
  const sarScore = calculateSARScore({
    monthlyIncome,
    dti,
    nsfCount,
    riskScore
  });

  // 6. D√©terminer recommandation
  const recommendation = determineRecommendation(sarScore);

  // 7. Calculer montant max
  const maxLoanAmount = calculateMaxLoan(monthlyIncome, dti, sarScore);

  return {
    recommendation,
    max_loan_amount: maxLoanAmount,
    confidence: calculateConfidence(rawData),
    sar_score: sarScore,
    factors: {
      income_stability: calculateIncomeStability(rawData),
      dti_ratio: dti,
      nsf_history: nsfCount,
      account_age: calculateAccountAge(rawData)
    },
    red_flags: detectRedFlags(rawData)
  };
}
```

**Acceptance Criteria:**
- [ ] Fonction analyse compl√®te impl√©ment√©e
- [ ] Tests unitaires pour chaque calcul
- [ ] Score SAR entre 300-850
- [ ] Recommandation coh√©rente

---

#### ‚òê T√¢che 3.2: Int√©grer Moteur dans API
**Dur√©e:** 2 heures
**Fichiers:**
- [ ] Modifier `/src/app/api/admin/client-analysis/route.ts`

**Code:**
```typescript
// Apr√®s insertion dans Supabase
if (data && data.raw_data) {
  // Analyser automatiquement
  const analysis = analyzeLoanApplication(
    data.raw_data,
    body.risk_score
  );

  // Mettre √† jour avec l'analyse
  await supabase
    .from('client_analyses')
    .update({
      sar_score: analysis.sar_score,
      recommendation: analysis.recommendation,
      max_loan_amount: analysis.max_loan_amount,
      analysis_data: analysis
    })
    .eq('id', data.id);
}
```

**Acceptance Criteria:**
- [ ] Analyse automatique √† la r√©ception
- [ ] R√©sultats stock√©s dans Supabase
- [ ] Pas d'erreur si analyse √©choue

---

#### ‚òê T√¢che 3.3: Afficher Recommandation dans Admin
**Dur√©e:** 3 heures
**Fichiers:**
- [ ] Modifier `/src/app/admin/analyse/page.tsx`

**UI:**
```tsx
{/* Recommandation Card */}
<div className="card-recommendation">
  <h2 className="text-3xl font-bold">
    {analysis.recommendation === 'approve' && '‚úÖ APPROUVER'}
    {analysis.recommendation === 'decline' && '‚ùå REFUSER'}
    {analysis.recommendation === 'review' && '‚ö†Ô∏è R√âVISION MANUELLE'}
  </h2>

  <div className="grid grid-cols-2 gap-4 mt-6">
    <div>
      <p className="text-sm text-gray-500">Score SAR</p>
      <p className="text-4xl font-bold">{analysis.sar_score}/850</p>
    </div>
    <div>
      <p className="text-sm text-gray-500">Montant Max</p>
      <p className="text-4xl font-bold">{formatCurrency(analysis.max_loan_amount)}</p>
    </div>
  </div>

  <div className="mt-6 flex gap-4">
    <button className="btn-primary">
      Approuver {formatCurrency(analysis.max_loan_amount)}
    </button>
    <button className="btn-secondary">
      Ajuster Montant
    </button>
    <button className="btn-danger">
      Refuser
    </button>
  </div>
</div>
```

**Acceptance Criteria:**
- [ ] Recommandation affich√©e en haut de page
- [ ] Score SAR visible
- [ ] Montant max sugg√©r√©
- [ ] Boutons d'action rapides
- [ ] Admin peut override la d√©cision

---

### üîµ PHASE 4: BONUS / NICE-TO-HAVE (Priorit√© BASSE)

#### ‚òê T√¢che 4.1: T√©l√©charger PDF Reports
**Dur√©e:** 2 heures
- [ ] Ajouter bouton "T√©l√©charger Rapport PDF" dans admin
- [ ] Appeler `/api/v2/pdf_report/{guid}?type=income`
- [ ] Sauvegarder PDF avec le dossier client

#### ‚òê T√¢che 4.2: Historique des D√©cisions
**Dur√©e:** 3 heures
- [ ] Cr√©er table `loan_decisions` dans Supabase
- [ ] Logger chaque d√©cision (approve/decline)
- [ ] Afficher historique dans admin

#### ‚òê T√¢che 4.3: Notifications Slack/Email
**Dur√©e:** 2 heures
- [ ] Envoyer notification quand nouvelle analyse arrive
- [ ] Alerter si risk_score < 600
- [ ] R√©sum√© quotidien des analyses

---

## üìä R√âSUM√â VISUEL DES PHASES

```
PHASE 1: COMBLER LE TROU (URGENT)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Extension V2 ‚Üí SAR API ‚Üí Supabase ‚îÇ  ‚è±Ô∏è 6-8 heures
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Impact: üî•üî•üî• CRITIQUE (syst√®me non fonctionnel sans √ßa)

PHASE 2: ENRICHIR DONN√âES (HAUTE)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ + Risk Score + Microcheck         ‚îÇ  ‚è±Ô∏è 8-10 heures
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Impact: üî•üî• √âLEV√â (am√©liore d√©cisions 10x)

PHASE 3: ANALYSE AUTO (MOYENNE)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Moteur d'analyse + Recommandations‚îÇ  ‚è±Ô∏è 12-15 heures
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Impact: üî• MOYEN (√©conomise temps agents)

PHASE 4: BONUS (BASSE)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PDF + Historique + Notifications  ‚îÇ  ‚è±Ô∏è 6-8 heures
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Impact: üí° FAIBLE (nice-to-have)
```

---

## üéØ ESTIMATION TOTALE

| Phase | T√¢ches | Dur√©e | Impact |
|-------|--------|-------|--------|
| **Phase 1** | Extension V2 + Upload auto | 6-8h | üî•üî•üî• CRITIQUE |
| **Phase 2** | Risk Score + Microcheck | 8-10h | üî•üî• √âLEV√â |
| **Phase 3** | Moteur d'analyse | 12-15h | üî• MOYEN |
| **Phase 4** | Bonus features | 6-8h | üí° FAIBLE |
| **TOTAL** | | **32-41h** | |

**Planning sugg√©r√©:**
- **Semaine 1:** Phase 1 (Extension V2) ‚Üê URGENT
- **Semaine 2:** Phase 2 (Risk Score + Microcheck)
- **Semaine 3:** Phase 3 (Moteur d'analyse)
- **Semaine 4:** Phase 4 (Bonus) + Tests + Polish

---

## ‚úÖ CHECKLIST RAPIDE (√Ä IMPRIMER)

### Sprint 1: D√©bloquer le Syst√®me (2-3 jours)
- [ ] Extension Chrome V2 cr√©√©e
- [ ] Token Bearer g√©n√©r√©
- [ ] Upload automatique vers SAR fonctionne
- [ ] Donn√©es arrivent dans Supabase
- [ ] Admin peut voir les analyses

### Sprint 2: Enrichir les Donn√©es (3-4 jours)
- [ ] Risk Score int√©gr√©
- [ ] Microcheck int√©gr√©
- [ ] Sch√©ma Supabase mis √† jour
- [ ] UI affiche Risk Score et warnings

### Sprint 3: Automatiser D√©cisions (5-7 jours)
- [ ] Moteur d'analyse cr√©√©
- [ ] Score SAR calcul√© (300-850)
- [ ] Recommandations g√©n√©r√©es
- [ ] UI affiche recommandation avec boutons actions

### Sprint 4: Polish & Bonus (3-4 jours)
- [ ] PDF Reports
- [ ] Historique d√©cisions
- [ ] Notifications
- [ ] Tests end-to-end

---

**Pr√™t √† commencer par la Phase 1?** üöÄ

Je peux te guider √©tape par √©tape pour cr√©er l'Extension Chrome V2!
