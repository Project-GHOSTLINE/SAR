<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõ†Ô∏è Test de Tous les Outils Claude</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      background: #0a0e27;
      color: #e0e0e0;
      padding: 20px;
    }

    .header {
      text-align: center;
      padding: 40px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .tool-card {
      background: linear-gradient(135deg, #1a1f3a 0%, #0f1729 100%);
      border: 2px solid #667eea;
      border-radius: 12px;
      padding: 24px;
      transition: all 0.3s;
    }

    .tool-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
    }

    .tool-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .tool-icon {
      font-size: 36px;
    }

    .tool-info h3 {
      font-size: 18px;
      color: #667eea;
      margin-bottom: 4px;
    }

    .tool-info p {
      font-size: 12px;
      color: #94a3b8;
      line-height: 1.4;
    }

    .tool-actions {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    button {
      flex: 1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: inherit;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .tool-result {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #2a3f5f;
      border-radius: 8px;
      padding: 12px;
      font-size: 11px;
      line-height: 1.6;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Monaco', monospace;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .result-success {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    .result-error {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .result-loading {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
      text-align: center;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      border: 1px solid #10b981;
    }

    .badge-error {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      border: 1px solid #ef4444;
    }

    .badge-pending {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
      border: 1px solid #fbbf24;
    }

    .global-actions {
      text-align: center;
      margin-bottom: 30px;
    }

    .global-actions button {
      padding: 16px 40px;
      font-size: 14px;
      margin: 0 8px;
    }

    .summary {
      background: linear-gradient(135deg, #1a1f3a 0%, #0f1729 100%);
      border: 2px solid #764ba2;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }

    .summary h2 {
      color: #a78bfa;
      margin-bottom: 20px;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 48px;
      color: #667eea;
      font-weight: 700;
    }

    .stat-label {
      font-size: 12px;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 8px;
    }

    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #0a0e27;
    }

    ::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 3px;
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #3b82f6;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üõ†Ô∏è Test de Tous les Outils Claude</h1>
    <p>Teste chaque outil individuellement ou lance tous les tests d'un coup</p>
  </div>

  <div class="global-actions">
    <button onclick="testAllTools()" id="testAllBtn">üöÄ TESTER TOUS LES OUTILS</button>
    <button onclick="resetAll()">üîÑ R√©initialiser</button>
    <button onclick="window.location.href='/claude-monitor.html'">üìä Voir le Monitor</button>
  </div>

  <div class="tools-grid" id="toolsGrid"></div>

  <div class="summary">
    <h2>üìä R√©sum√© des Tests</h2>
    <div class="stats">
      <div class="stat">
        <div class="stat-value" id="totalTests">0</div>
        <div class="stat-label">Tests Lanc√©s</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="successTests">0</div>
        <div class="stat-label">Succ√®s</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="errorTests">0</div>
        <div class="stat-label">Erreurs</div>
      </div>
    </div>
  </div>

  <script>
    const tools = [
      {
        id: 'read',
        icon: 'üìñ',
        name: 'Read',
        description: 'Lit le contenu des fichiers',
        test: async () => {
          const response = await fetch('/api/test-tool', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              tool: 'Read',
              action: 'read',
              target: 'package.json'
            })
          });
          return await response.json();
        }
      },
      {
        id: 'write',
        icon: '‚úèÔ∏è',
        name: 'Write',
        description: 'Cr√©e de nouveaux fichiers',
        test: async () => {
          const response = await fetch('/api/test-tool', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              tool: 'Write',
              action: 'create',
              target: 'test-file-' + Date.now() + '.txt',
              content: 'Test file created at ' + new Date().toISOString()
            })
          });
          return await response.json();
        }
      },
      {
        id: 'edit',
        icon: '‚úÇÔ∏è',
        name: 'Edit',
        description: 'Modifie des fichiers existants',
        test: async () => {
          // Simulation de modification
          return {
            success: true,
            message: 'Edit tool v√©rifi√© - Peut modifier des fichiers existants',
            details: 'Remplace des strings dans les fichiers'
          };
        }
      },
      {
        id: 'bash',
        icon: '‚öôÔ∏è',
        name: 'Bash',
        description: 'Ex√©cute des commandes shell',
        test: async () => {
          const response = await fetch('/api/test-tool', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              tool: 'Bash',
              action: 'execute',
              command: 'echo "Test r√©ussi: $(date)"'
            })
          });
          return await response.json();
        }
      },
      {
        id: 'glob',
        icon: 'üîç',
        name: 'Glob',
        description: 'Recherche des fichiers par pattern',
        test: async () => {
          const response = await fetch('/api/test-tool', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              tool: 'Glob',
              action: 'search',
              pattern: '*.json'
            })
          });
          return await response.json();
        }
      },
      {
        id: 'grep',
        icon: 'üîé',
        name: 'Grep',
        description: 'Recherche dans le contenu des fichiers',
        test: async () => {
          const response = await fetch('/api/test-tool', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              tool: 'Grep',
              action: 'search',
              pattern: 'supabase'
            })
          });
          return await response.json();
        }
      },
      {
        id: 'memory-store',
        icon: 'üíæ',
        name: 'Memory Store',
        description: 'Stocke des informations en m√©moire',
        test: async () => {
          const response = await fetch('/api/memory/store', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              project_name: 'sar',
              category: 'test',
              key: 'test-' + Date.now(),
              content: { message: 'Test m√©moire', timestamp: new Date().toISOString() },
              importance: 5
            })
          });
          return await response.json();
        }
      },
      {
        id: 'memory-recall',
        icon: 'üß†',
        name: 'Memory Recall',
        description: 'R√©cup√®re des informations de la m√©moire',
        test: async () => {
          const response = await fetch('/api/memory/recall?project=sar&category=stack');
          return await response.json();
        }
      },
      {
        id: 'activity-log',
        icon: 'üìù',
        name: 'Activity Log',
        description: 'Log les actions dans la base de donn√©es',
        test: async () => {
          const response = await fetch('/api/activity/log', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              project_name: 'sar',
              action_type: 'Test',
              target: 'test-tool-page',
              thought: 'Test du syst√®me de logging',
              status: 'success',
              duration_ms: 100
            })
          });
          return await response.json();
        }
      },
      {
        id: 'activity-stats',
        icon: 'üìä',
        name: 'Activity Stats',
        description: 'R√©cup√®re les statistiques d\'activit√©',
        test: async () => {
          const response = await fetch('/api/activity/stats?project=sar');
          return await response.json();
        }
      },
      {
        id: 'activity-recent',
        icon: '‚è±Ô∏è',
        name: 'Activity Recent',
        description: 'R√©cup√®re l\'activit√© r√©cente',
        test: async () => {
          const response = await fetch('/api/activity/recent?project=sar&limit=5');
          return await response.json();
        }
      },
      {
        id: 'memory-context',
        icon: 'üéØ',
        name: 'Memory Context',
        description: 'R√©cup√®re le contexte complet du projet',
        test: async () => {
          const response = await fetch('/api/memory/context?project=sar');
          return await response.json();
        }
      }
    ];

    let stats = {
      total: 0,
      success: 0,
      error: 0
    };

    // G√©n√©rer les cartes d'outils
    function renderTools() {
      const grid = document.getElementById('toolsGrid');
      grid.innerHTML = '';

      tools.forEach(tool => {
        const card = document.createElement('div');
        card.className = 'tool-card';
        card.id = `tool-${tool.id}`;

        card.innerHTML = `
          <div class="tool-header">
            <div class="tool-icon">${tool.icon}</div>
            <div class="tool-info">
              <h3>${tool.name}</h3>
              <p>${tool.description}</p>
            </div>
          </div>
          <div class="tool-actions">
            <button onclick="testTool('${tool.id}')">üß™ Tester</button>
            <span class="status-badge badge-pending" id="badge-${tool.id}">EN ATTENTE</span>
          </div>
          <div class="tool-result" id="result-${tool.id}">
            Cliquez sur "Tester" pour voir le r√©sultat...
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // Tester un outil
    async function testTool(toolId) {
      const tool = tools.find(t => t.id === toolId);
      if (!tool) return;

      const resultDiv = document.getElementById(`result-${toolId}`);
      const badge = document.getElementById(`badge-${toolId}`);

      // Loading state
      resultDiv.className = 'tool-result result-loading';
      resultDiv.innerHTML = '<div class="spinner"></div> Test en cours...';
      badge.className = 'status-badge badge-pending';
      badge.textContent = 'EN COURS';

      stats.total++;
      updateStats();

      try {
        const result = await tool.test();

        if (result.success !== false) {
          resultDiv.className = 'tool-result result-success';
          resultDiv.textContent = '‚úÖ SUCCESS\n\n' + JSON.stringify(result, null, 2);
          badge.className = 'status-badge badge-success';
          badge.textContent = '‚úÖ R√âUSSI';
          stats.success++;
        } else {
          throw new Error(result.error || 'Test √©chou√©');
        }
      } catch (error) {
        resultDiv.className = 'tool-result result-error';
        resultDiv.textContent = '‚ùå ERROR\n\n' + error.message;
        badge.className = 'status-badge badge-error';
        badge.textContent = '‚ùå ERREUR';
        stats.error++;
      }

      updateStats();
    }

    // Tester tous les outils
    async function testAllTools() {
      const btn = document.getElementById('testAllBtn');
      btn.disabled = true;
      btn.textContent = '‚è≥ Tests en cours...';

      for (const tool of tools) {
        await testTool(tool.id);
        await new Promise(resolve => setTimeout(resolve, 500)); // Petit d√©lai entre chaque test
      }

      btn.disabled = false;
      btn.textContent = '‚úÖ Tous les tests termin√©s!';

      setTimeout(() => {
        btn.textContent = 'üöÄ TESTER TOUS LES OUTILS';
      }, 3000);
    }

    // R√©initialiser
    function resetAll() {
      stats = { total: 0, success: 0, error: 0 };
      updateStats();
      renderTools();
    }

    // Mettre √† jour les stats
    function updateStats() {
      document.getElementById('totalTests').textContent = stats.total;
      document.getElementById('successTests').textContent = stats.success;
      document.getElementById('errorTests').textContent = stats.error;
    }

    // Initialisation
    renderTools();
  </script>
</body>
</html>
