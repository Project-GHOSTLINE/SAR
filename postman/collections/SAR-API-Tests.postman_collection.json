{
	"info": {
		"_postman_id": "sar-api-tests-001",
		"name": "SAR - API Tests Complete",
		"description": "Collection complète de tests API pour SAR Admin Dashboard",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "sar-team"
	},
	"item": [
		{
			"name": "1. Admin - Authentication",
			"item": [
				{
					"name": "Login Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has success property\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"});",
									"",
									"pm.test(\"Response time is less than 500ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(500);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"password\": \"{{ADMIN_PASSWORD}}\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/admin/login",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "admin", "login"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "2. QuickBooks - Status & Connection",
			"item": [
				{
					"name": "Get QuickBooks Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Has connection object\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('connection');",
									"    pm.expect(jsonData.connection).to.have.property('connected');",
									"});",
									"",
									"pm.test(\"Connected is boolean\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(typeof jsonData.connection.connected).to.eql('boolean');",
									"});",
									"",
									"pm.test(\"Response time is less than 1000ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(1000);",
									"});",
									"",
									"// Save connection status for later tests",
									"var jsonData = pm.response.json();",
									"pm.environment.set(\"QB_CONNECTED\", jsonData.connection.connected);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/status",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "status"]
						}
					},
					"response": []
				},
				{
					"name": "Initiate OAuth Connection",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Has authUrl\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('authUrl');",
									"    pm.expect(jsonData.authUrl).to.include('appcenter.intuit.com');",
									"});",
									"",
									"pm.test(\"AuthUrl contains correct scopes\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.authUrl).to.include('com.intuit.quickbooks.accounting');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/auth/connect",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "auth", "connect"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "3. QuickBooks - Sync Operations",
			"item": [
				{
					"name": "Sync Customers",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Skip if QuickBooks not connected",
									"if (pm.environment.get(\"QB_CONNECTED\") === \"false\") {",
									"    console.log(\"⚠️ QuickBooks not connected - skipping test\");",
									"    pm.execution.skipRequest();",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 401\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Has success or data property\", function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.success || jsonData.data).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/sync/customers",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "sync", "customers"]
						}
					},
					"response": []
				},
				{
					"name": "Sync Invoices",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (pm.environment.get(\"QB_CONNECTED\") === \"false\") {",
									"    pm.execution.skipRequest();",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 401\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/sync/invoices",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "sync", "invoices"]
						}
					},
					"response": []
				},
				{
					"name": "Sync Payments",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (pm.environment.get(\"QB_CONNECTED\") === \"false\") {",
									"    pm.execution.skipRequest();",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 401\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/sync/payments",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "sync", "payments"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "4. QuickBooks - Reports",
			"item": [
				{
					"name": "Profit & Loss Report",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (pm.environment.get(\"QB_CONNECTED\") === \"false\") {",
									"    pm.execution.skipRequest();",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 401\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});",
									"",
									"pm.test(\"Response time is less than 5000ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(5000);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/reports/profit-loss",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "reports", "profit-loss"]
						}
					},
					"response": []
				},
				{
					"name": "Balance Sheet Report",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (pm.environment.get(\"QB_CONNECTED\") === \"false\") {",
									"    pm.execution.skipRequest();",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 401\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/reports/balance-sheet",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "reports", "balance-sheet"]
						}
					},
					"response": []
				},
				{
					"name": "Cash Flow Report",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (pm.environment.get(\"QB_CONNECTED\") === \"false\") {",
									"    pm.execution.skipRequest();",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 401\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/quickbooks/reports/cash-flow",
							"host": ["{{BASE_URL}}"],
							"path": ["api", "quickbooks", "reports", "cash-flow"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "5. Health Checks",
			"item": [
				{
					"name": "App Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 2000ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(2000);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/",
							"host": ["{{BASE_URL}}"],
							"path": [""]
						}
					},
					"response": []
				}
			]
		}
	]
}
